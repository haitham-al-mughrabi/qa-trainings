{% extends 'base.html' %}

{% block content %}
<style>
    .profile-header {
        background: linear-gradient(135deg, rgba(99, 102, 241, 0.15) 0%, rgba(168, 85, 247, 0.15) 100%);
        border: 1px solid rgba(99, 102, 241, 0.2);
        border-radius: 16px;
        padding: 40px;
        margin-bottom: 30px;
        position: relative;
        overflow: hidden;
    }

    .profile-header::before {
        content: '';
        position: absolute;
        top: -50%;
        right: -10%;
        width: 400px;
        height: 400px;
        background: radial-gradient(circle, rgba(99, 102, 241, 0.2) 0%, transparent 70%);
        border-radius: 50%;
    }

    .student-name {
        font-size: 32px;
        font-weight: 700;
        margin: 0 0 20px 0;
        position: relative;
        z-index: 1;
    }

    .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 16px;
        position: relative;
        z-index: 1;
    }

    .stat-card {
        background: rgba(99, 102, 241, 0.1);
        border: 1px solid rgba(99, 102, 241, 0.2);
        border-radius: 10px;
        padding: 16px;
        text-align: center;
    }

    .stat-value {
        font-size: 28px;
        font-weight: 700;
        color: var(--accent);
        margin-bottom: 4px;
    }

    .stat-label {
        font-size: 13px;
        color: var(--muted);
    }

    .section-title {
        font-size: 24px;
        font-weight: 600;
        margin-bottom: 20px;
    }

    .training-section {
        margin-bottom: 40px;
    }

    .training-header {
        background: linear-gradient(135deg, rgba(30, 41, 59, 0.8) 0%, rgba(30, 41, 59, 0.6) 100%);
        border: 1px solid rgba(99, 102, 241, 0.15);
        border-radius: 12px;
        padding: 20px;
        margin-bottom: 16px;
    }

    .training-name {
        font-size: 20px;
        font-weight: 600;
        margin: 0;
    }

    .topics-list {
        display: grid;
        gap: 12px;
    }

    .topic-item {
        background: linear-gradient(135deg, rgba(30, 41, 59, 0.8) 0%, rgba(30, 41, 59, 0.6) 100%);
        border: 1px solid rgba(99, 102, 241, 0.15);
        border-radius: 10px;
        padding: 16px;
        display: grid;
        grid-template-columns: 1fr auto auto;
        gap: 16px;
        align-items: center;
    }

    .topic-name {
        font-size: 15px;
        font-weight: 500;
        color: var(--text);
    }

    .topic-phase {
        font-size: 12px;
        color: var(--muted);
        margin-top: 4px;
    }

    .status-badge {
        padding: 6px 12px;
        border-radius: 6px;
        font-size: 12px;
        font-weight: 500;
        white-space: nowrap;
    }

    .status-present {
        background: rgba(34, 197, 94, 0.15);
        color: #22c55e;
        border: 1px solid rgba(34, 197, 94, 0.3);
    }

    .status-absent {
        background: rgba(239, 68, 68, 0.15);
        color: #ef4444;
        border: 1px solid rgba(239, 68, 68, 0.3);
    }

    .status-excused {
        background: rgba(251, 191, 36, 0.15);
        color: #fbbf24;
        border: 1px solid rgba(251, 191, 36, 0.3);
    }

    .status-completed {
        background: rgba(99, 102, 241, 0.15);
        color: var(--accent);
        border: 1px solid rgba(99, 102, 241, 0.3);
    }

    .status-in-progress {
        background: rgba(251, 191, 36, 0.15);
        color: #fbbf24;
        border: 1px solid rgba(251, 191, 36, 0.3);
    }

    .status-not-started {
        background: rgba(148, 163, 184, 0.15);
        color: var(--muted);
        border: 1px solid rgba(148, 163, 184, 0.3);
    }

    .empty-state {
        text-align: center;
        padding: 60px 20px;
        color: var(--muted);
    }
</style>

<!-- Profile Header -->
<div class="profile-header">
    <h1 class="student-name">{{ student.name }}</h1>
    <div class="stats-grid">
        <div class="stat-card">
            <div class="stat-value">{{ stats.total_trainings }}</div>
            <div class="stat-label">Enrolled Trainings</div>
        </div>
        <div class="stat-card">
            <div class="stat-value">{{ stats.total_topics }}</div>
            <div class="stat-label">Total Topics</div>
        </div>
        <div class="stat-card">
            <div class="stat-value">{{ stats.attendance_rate }}%</div>
            <div class="stat-label">Attendance Rate</div>
        </div>
        <div class="stat-card">
            <div class="stat-value">{{ stats.completion_rate }}%</div>
            <div class="stat-label">Completion Rate</div>
        </div>
        <div class="stat-card">
            <div class="stat-value">{{ stats.total_skills }}</div>
            <div class="stat-label">Assessed Skills</div>
        </div>
    </div>
</div>

<!-- Knowledge Skills Section -->
{% if assessments_by_category %}
<div class="training-section">
    <h2 class="section-title">Knowledge & Skills</h2>

    {% for category, assessments in assessments_by_category.items() %}
    <div class="training-header">
        <h3 class="training-name">{{ category }}</h3>
    </div>

    <div class="topics-list">
        {% for assessment in assessments %}
        <div class="topic-item" style="grid-template-columns: 1fr auto;">
            <div>
                <div class="topic-name">{{ assessment.topic }}</div>
                <div class="topic-phase">Last updated: {{ assessment.last_updated.strftime('%Y-%m-%d') if
                    assessment.last_updated else 'N/A' }}</div>
            </div>

            <div>
                {% if assessment.proficiency_level == 'Beginner' %}
                <span class="status-badge"
                    style="background: rgba(148, 163, 184, 0.15); color: var(--muted); border: 1px solid rgba(148, 163, 184, 0.3);">
                    Beginner
                </span>
                {% elif assessment.proficiency_level == 'Intermediate' %}
                <span class="status-badge"
                    style="background: rgba(59, 130, 246, 0.15); color: #3b82f6; border: 1px solid rgba(59, 130, 246, 0.3);">
                    Intermediate
                </span>
                {% elif assessment.proficiency_level == 'Advance' %}
                <span class="status-badge"
                    style="background: rgba(251, 191, 36, 0.15); color: #fbbf24; border: 1px solid rgba(251, 191, 36, 0.3);">
                    Advance
                </span>
                {% elif assessment.proficiency_level == 'Expert' %}
                <span class="status-badge"
                    style="background: rgba(34, 197, 94, 0.15); color: #22c55e; border: 1px solid rgba(34, 197, 94, 0.3);">
                    Expert
                </span>
                {% endif %}
            </div>
        </div>
        {% endfor %}
    </div>
    {% endfor %}
</div>
{% endif %}

<!-- Trainings and Topics -->
{% if trainings %}
{% for training in trainings %}
<div class="training-section">
    <div class="training-header">
        <h2 class="training-name">{{ training.name }}</h2>
    </div>

    <div class="topics-list">
        {% for topic in topics if topic.training_id == training.id %}
        <div class="topic-item">
            <div>
                <div class="topic-name">{{ topic.name }}</div>
                {% if topic.phase %}
                <div class="topic-phase">{{ topic.phase|regex_replace('^\d+\s*-\s*', '') }}</div>
                {% endif %}
            </div>

            <div>
                {% if attendance_map.get(topic.id) %}
                {% if attendance_map[topic.id].status == 'Present' %}
                <span class="status-badge status-present">✓ Present</span>
                {% elif attendance_map[topic.id].status == 'Absent' %}
                <span class="status-badge status-absent">✗ Absent</span>
                {% elif attendance_map[topic.id].status == 'Excused' %}
                <span class="status-badge status-excused">⊘ Excused</span>
                {% endif %}
                {% else %}
                <span class="status-badge status-not-started">No Record</span>
                {% endif %}
            </div>

            <div>
                {% if progress_map.get(topic.id) %}
                {% if progress_map[topic.id].status == 'Completed' %}
                <span class="status-badge status-completed">✓ Completed</span>
                {% elif progress_map[topic.id].status == 'In Progress' %}
                <span class="status-badge status-in-progress">◐ In Progress</span>
                {% elif progress_map[topic.id].status == 'Not Started' %}
                <span class="status-badge status-not-started">○ Not Started</span>
                {% endif %}
                {% else %}
                <span class="status-badge status-not-started">○ Not Started</span>
                {% endif %}
            </div>
        </div>
        {% endfor %}
    </div>
</div>
{% endfor %}
{% else %}
<div class="empty-state">
    <p style="font-size: 16px;">No training records found for this student.</p>
    <p style="font-size: 14px; margin-top: 8px;">Attendance and progress records will appear here once added.</p>
</div>
{% endif %}

{% endblock %}