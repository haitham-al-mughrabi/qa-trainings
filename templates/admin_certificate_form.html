{% extends 'base.html' %}

{% block content %}
<div class="admin-container" style="padding: 40px 20px; max-width: 1000px; margin: 0 auto;">
    <div class="admin-header" style="margin-bottom: 30px;">
        <h1 style="font-size: 28px; font-weight: 700; margin-bottom: 8px;">
            {% if certificate %}Edit Certificate{% else %}Issue New Certificate{% endif %}
        </h1>
        <p style="color: var(--text-light);">Customize certificate details and signatures</p>
    </div>

    <form method="POST" class="admin-form" style="display: grid; gap: 30px;">
        <!-- Student & Training Selection -->
        <div class="form-section"
            style="background: rgba(30, 41, 59, 0.7); border: 1px solid rgba(99, 102, 241, 0.2); border-radius: 16px; padding: 24px;">
            <h3 style="font-size: 18px; font-weight: 600; margin-bottom: 20px; color: var(--accent);">Recipient Details
            </h3>

            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                <div class="form-group">
                    <label style="display: block; margin-bottom: 8px; font-size: 14px; font-weight: 500;">Select
                        Student</label>
                    <select name="student_id" required
                        style="width: 100%; padding: 12px; background: rgba(15, 23, 42, 0.6); border: 1px solid rgba(99, 102, 241, 0.2); border-radius: 8px; color: var(--text);">
                        <option value="">-- Select Student --</option>
                        {% for student in students %}
                        <option value="{{ student.id }}" {% if certificate and certificate.student_id==student.id
                            %}selected{% endif %}>
                            {{ student.name }}
                        </option>
                        {% endfor %}
                    </select>
                </div>

                <div class="form-group">
                    <label style="display: block; margin-bottom: 8px; font-size: 14px; font-weight: 500;">Select
                        Training (Optional)</label>
                    <select name="training_id"
                        style="width: 100%; padding: 12px; background: rgba(15, 23, 42, 0.6); border: 1px solid rgba(99, 102, 241, 0.2); border-radius: 8px; color: var(--text);">
                        <option value="">-- Custom / No Training --</option>
                        {% for training in trainings %}
                        <option value="{{ training.id }}" {% if certificate and certificate.training_id==training.id
                            %}selected{% endif %}>
                            {{ training.name }}
                        </option>
                        {% endfor %}
                    </select>
                </div>
            </div>
        </div>

        <!-- Certificate Content -->
        <div class="form-section"
            style="background: rgba(30, 41, 59, 0.7); border: 1px solid rgba(99, 102, 241, 0.2); border-radius: 16px; padding: 24px;">
            <h3 style="font-size: 18px; font-weight: 600; margin-bottom: 20px; color: var(--accent);">Certificate
                Content</h3>

            <div class="form-group" style="margin-bottom: 20px;">
                <label style="display: block; margin-bottom: 8px; font-size: 14px; font-weight: 500;">Certificate
                    Title</label>
                <input type="text" name="certificate_title"
                    value="{{ certificate.certificate_title if certificate else 'CERTIFICATE OF COMPLETION' }}"
                    style="width: 100%; padding: 12px; background: rgba(15, 23, 42, 0.6); border: 1px solid rgba(99, 102, 241, 0.2); border-radius: 8px; color: var(--text);">
            </div>

            <div class="form-group" style="margin-bottom: 20px;">
                <label style="display: block; margin-bottom: 8px; font-size: 14px; font-weight: 500;">Student Name (on
                    certificate)</label>
                <input type="text" name="student_name" value="{{ certificate.student_name if certificate else '' }}"
                    placeholder="Leave empty to use student's registered name"
                    style="width: 100%; padding: 12px; background: rgba(15, 23, 42, 0.6); border: 1px solid rgba(99, 102, 241, 0.2); border-radius: 8px; color: var(--text);">
            </div>

            <div class="form-group" style="margin-bottom: 20px;">
                <label style="display: block; margin-bottom: 8px; font-size: 14px; font-weight: 500;">Course
                    Name</label>
                <input type="text" name="course_name" value="{{ certificate.course_name if certificate else '' }}"
                    placeholder="Leave empty to use training name"
                    style="width: 100%; padding: 12px; background: rgba(15, 23, 42, 0.6); border: 1px solid rgba(99, 102, 241, 0.2); border-radius: 8px; color: var(--text);">
            </div>

            <div class="form-group" style="margin-bottom: 20px;">
                <label style="display: block; margin-bottom: 8px; font-size: 14px; font-weight: 500;">Certificate
                    Text</label>
                <textarea name="certificate_text" rows="2"
                    style="width: 100%; padding: 12px; background: rgba(15, 23, 42, 0.6); border: 1px solid rgba(99, 102, 241, 0.2); border-radius: 8px; color: var(--text); font-family: inherit;">{{ certificate.certificate_text if certificate else 'has successfully completed the comprehensive training program in' }}</textarea>
            </div>

            <div class="form-group">
                <label style="display: block; margin-bottom: 8px; font-size: 14px; font-weight: 500;">Completion
                    Date</label>
                <input type="date" name="completion_date"
                    value="{{ certificate.completion_date.strftime('%Y-%m-%d') if certificate else today.strftime('%Y-%m-%d') }}"
                    required
                    style="width: 100%; padding: 12px; background: rgba(15, 23, 42, 0.6); border: 1px solid rgba(99, 102, 241, 0.2); border-radius: 8px; color: var(--text);">
            </div>
        </div>

        <!-- Signatures -->
        <div class="form-section"
            style="background: rgba(30, 41, 59, 0.7); border: 1px solid rgba(99, 102, 241, 0.2); border-radius: 16px; padding: 24px;">
            <h3 style="font-size: 18px; font-weight: 600; margin-bottom: 20px; color: var(--accent);">Signatures</h3>

            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                <div class="form-group">
                    <label style="display: block; margin-bottom: 8px; font-size: 14px; font-weight: 500;">Signature 1
                        Name</label>
                    <input type="text" name="signature_1_name"
                        value="{{ certificate.signature_1_name if certificate else 'Haitham Al Mughrabi' }}"
                        style="width: 100%; padding: 12px; background: rgba(15, 23, 42, 0.6); border: 1px solid rgba(99, 102, 241, 0.2); border-radius: 8px; color: var(--text);">
                </div>
                <div class="form-group">
                    <label style="display: block; margin-bottom: 8px; font-size: 14px; font-weight: 500;">Signature 1
                        Title</label>
                    <input type="text" name="signature_1_title"
                        value="{{ certificate.signature_1_title if certificate else 'Senior QA Engineer' }}"
                        style="width: 100%; padding: 12px; background: rgba(15, 23, 42, 0.6); border: 1px solid rgba(99, 102, 241, 0.2); border-radius: 8px; color: var(--text);">
                </div>
            </div>

            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                <div class="form-group">
                    <label style="display: block; margin-bottom: 8px; font-size: 14px; font-weight: 500;">Signature 2
                        Name (Optional)</label>
                    <input type="text" name="signature_2_name"
                        value="{{ certificate.signature_2_name if certificate else '' }}"
                        style="width: 100%; padding: 12px; background: rgba(15, 23, 42, 0.6); border: 1px solid rgba(99, 102, 241, 0.2); border-radius: 8px; color: var(--text);">
                </div>
                <div class="form-group">
                    <label style="display: block; margin-bottom: 8px; font-size: 14px; font-weight: 500;">Signature 2
                        Title (Optional)</label>
                    <input type="text" name="signature_2_title"
                        value="{{ certificate.signature_2_title if certificate else '' }}"
                        style="width: 100%; padding: 12px; background: rgba(15, 23, 42, 0.6); border: 1px solid rgba(99, 102, 241, 0.2); border-radius: 8px; color: var(--text);">
                </div>
            </div>

            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                <div class="form-group">
                    <label style="display: block; margin-bottom: 8px; font-size: 14px; font-weight: 500;">Signature 3
                        Name (Optional)</label>
                    <input type="text" name="signature_3_name"
                        value="{{ certificate.signature_3_name if certificate else '' }}"
                        style="width: 100%; padding: 12px; background: rgba(15, 23, 42, 0.6); border: 1px solid rgba(99, 102, 241, 0.2); border-radius: 8px; color: var(--text);">
                </div>
                <div class="form-group">
                    <label style="display: block; margin-bottom: 8px; font-size: 14px; font-weight: 500;">Signature 3
                        Title (Optional)</label>
                    <input type="text" name="signature_3_title"
                        value="{{ certificate.signature_3_title if certificate else '' }}"
                        style="width: 100%; padding: 12px; background: rgba(15, 23, 42, 0.6); border: 1px solid rgba(99, 102, 241, 0.2); border-radius: 8px; color: var(--text);">
                </div>
            </div>
        </div>

        <!-- Seal -->
        <div class="form-section"
            style="background: rgba(30, 41, 59, 0.7); border: 1px solid rgba(99, 102, 241, 0.2); border-radius: 16px; padding: 24px;">
            <h3 style="font-size: 18px; font-weight: 600; margin-bottom: 20px; color: var(--accent);">Seal</h3>
            <div class="form-group">
                <label style="display: block; margin-bottom: 8px; font-size: 14px; font-weight: 500;">Seal Text (use \n
                    for line break)</label>
                <input type="text" name="seal_text"
                    value="{{ certificate.seal_text if certificate else 'OFFICIAL\nSEAL' }}"
                    style="width: 100%; padding: 12px; background: rgba(15, 23, 42, 0.6); border: 1px solid rgba(99, 102, 241, 0.2); border-radius: 8px; color: var(--text);">
            </div>
        </div>

        <div class="form-actions" style="display: flex; gap: 16px; justify-content: flex-end; margin-top: 20px;">
            <a href="{{ url_for('admin_certificates') }}" class="btn-secondary">Cancel</a>
            <button type="submit" class="btn-primary">
                {% if certificate %}Update Certificate{% else %}Issue Certificate{% endif %}
            </button>
        </div>
    </form>
</div>
{% endblock %}