{% extends 'base.html' %}

{% block content %}
<style>
    /* ==================== ANIMATIONS ==================== */
    @keyframes float-slow {
        0%, 100% { transform: translateY(0px); }
        50% { transform: translateY(-20px); }
    }

    @keyframes slide-in-up {
        from {
            opacity: 0;
            transform: translateY(30px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    .training-header {
        position: relative;
        background: linear-gradient(180deg, rgba(56, 189, 248, 0.1) 0%, rgba(168, 85, 247, 0.05) 100%);
        border: 1px solid rgba(56, 189, 248, 0.2);
        border-radius: 24px;
        padding: 80px 40px;
        margin-bottom: 60px;
        overflow: hidden;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.2),
                    inset 0 1px 0 rgba(56, 189, 248, 0.1);
    }

    .training-header::before {
        content: '';
        position: absolute;
        top: -40%;
        left: 50%;
        transform: translateX(-50%);
        width: 600px;
        height: 600px;
        background: radial-gradient(circle, rgba(56, 189, 248, 0.15) 0%, transparent 70%);
        border-radius: 50%;
        animation: float-slow 8s ease-in-out infinite;
    }

    .training-header::after {
        content: '';
        position: absolute;
        bottom: -30%;
        right: -10%;
        width: 400px;
        height: 400px;
        background: radial-gradient(circle, rgba(168, 85, 247, 0.1) 0%, transparent 70%);
        border-radius: 50%;
        animation: float-slow 10s ease-in-out infinite;
    }

    /* Tabbed Navigation */
    .phase-tabs {
        position: sticky;
        top: 64px;
        z-index: 40;
        background: linear-gradient(180deg, rgba(15, 23, 42, 0.98) 0%, rgba(15, 23, 42, 0.95) 100%);
        backdrop-filter: blur(12px);
        border-bottom: 2px solid rgba(99, 102, 241, 0.2);
        margin: 0 -16px 40px;
        padding: 0 16px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
    }

    .tabs-container {
        display: flex;
        gap: 0;
        overflow-x: auto;
        scrollbar-width: none;
    }

    .tabs-container::-webkit-scrollbar {
        display: none;
    }

    .tab-btn {
        padding: 18px 24px;
        background: transparent;
        border: none;
        border-bottom: 3px solid transparent;
        color: var(--muted);
        text-decoration: none;
        white-space: nowrap;
        font-size: 14px;
        font-weight: 500;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        cursor: pointer;
        position: relative;
        display: flex;
        align-items: center;
        gap: 10px;
    }

    .tab-btn::after {
        content: '';
        position: absolute;
        bottom: 0;
        left: 50%;
        width: 0;
        height: 3px;
        background: linear-gradient(90deg, var(--accent), #a855f7);
        transform: translateX(-50%);
        transition: width 0.3s ease;
    }

    .tab-btn:hover {
        color: var(--text);
        background: rgba(99, 102, 241, 0.08);
    }

    .tab-btn:hover::after {
        width: 100%;
    }

    .tab-btn.active {
        color: var(--accent);
        background: rgba(99, 102, 241, 0.15);
    }

    .tab-btn.active::after {
        width: 100%;
    }

    .tab-number {
        width: 26px;
        height: 26px;
        background: rgba(148, 163, 184, 0.15);
        border: 1px solid rgba(148, 163, 184, 0.2);
        border-radius: 8px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 12px;
        font-weight: 700;
        transition: all 0.3s ease;
    }

    .tab-btn.active .tab-number {
        background: linear-gradient(135deg, var(--accent), #a855f7);
        border-color: transparent;
        color: white;
        box-shadow: 0 2px 8px rgba(99, 102, 241, 0.4);
    }

    .tab-count {
        font-size: 11px;
        opacity: 0.6;
        margin-left: 4px;
    }

    /* Phase Content */
    .phase-content {
        display: none;
    }

    .phase-content.active {
        display: block;
        animation: fadeIn 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    }

    @keyframes fadeIn {
        from {
            opacity: 0;
            transform: translateY(15px);
        }

        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    .phase-header {
        display: flex;
        align-items: center;
        gap: 15px;
        margin-bottom: 30px;
        padding: 20px;
        background: linear-gradient(135deg, rgba(99, 102, 241, 0.08) 0%, rgba(168, 85, 247, 0.08) 100%);
        border: 1px solid rgba(99, 102, 241, 0.15);
        border-radius: 12px;
    }

    .phase-number {
        width: 52px;
        height: 52px;
        background: linear-gradient(135deg, var(--accent), #a855f7);
        border-radius: 14px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: 700;
        font-size: 22px;
        color: white;
        box-shadow: 0 6px 16px rgba(99, 102, 241, 0.4);
    }

    .phase-title {
        font-size: 24px;
        font-weight: 600;
        color: var(--text);
        margin: 0;
    }

    .topic-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(360px, 1fr));
        gap: 28px;
    }

    .topic-card {
        position: relative;
        background: linear-gradient(135deg, rgba(15, 23, 42, 0.7) 0%, rgba(15, 23, 42, 0.5) 100%);
        border: 1.5px solid rgba(56, 189, 248, 0.15);
        border-radius: 18px;
        padding: 28px;
        text-decoration: none;
        color: inherit;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        overflow: hidden;
        backdrop-filter: blur(10px);
        display: flex;
        flex-direction: column;
        gap: 12px;
    }

    .topic-card::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 3px;
        background: linear-gradient(90deg, #38bdf8, #a855f7, #f97316);
        transform: scaleX(0);
        transform-origin: left;
        transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        z-index: 10;
    }

    .topic-card::after {
        content: '';
        position: absolute;
        top: -50%;
        right: -50%;
        width: 200%;
        height: 200%;
        background: radial-gradient(circle, rgba(56, 189, 248, 0.1) 0%, transparent 70%);
        opacity: 0;
        transition: all 0.4s ease;
    }

    .topic-card:hover {
        border-color: rgba(56, 189, 248, 0.4);
        background: linear-gradient(135deg, rgba(15, 23, 42, 0.9) 0%, rgba(15, 23, 42, 0.7) 100%);
        transform: translateY(-8px);
        box-shadow: 0 20px 50px rgba(56, 189, 248, 0.25);
    }

    .topic-card:hover::before {
        transform: scaleX(1);
    }

    .topic-card:hover::after {
        opacity: 1;
        top: -30%;
        right: -30%;
    }

    .topic-title {
        font-size: 18px;
        font-weight: 700;
        margin: 0;
        color: #f9fafb;
        line-height: 1.6;
        position: relative;
        z-index: 2;
    }

    .topic-meta {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
        align-items: center;
        position: relative;
        z-index: 2;
        padding-top: 12px;
        border-top: 1px solid rgba(56, 189, 248, 0.1);
    }

    .topic-badge {
        display: inline-flex;
        align-items: center;
        gap: 6px;
        padding: 6px 12px;
        background: rgba(56, 189, 248, 0.1);
        border: 1px solid rgba(56, 189, 248, 0.2);
        border-radius: 8px;
        font-size: 12px;
        color: #38bdf8;
        font-weight: 600;
        transition: all 0.3s ease;
    }

    .topic-badge:hover {
        background: rgba(56, 189, 248, 0.15);
        border-color: rgba(56, 189, 248, 0.4);
    }

    .topic-badge.video {
        background: rgba(56, 189, 248, 0.1);
        border-color: rgba(56, 189, 248, 0.2);
        color: #38bdf8;
    }

    .topic-badge.video:hover {
        background: rgba(56, 189, 248, 0.15);
        border-color: rgba(56, 189, 248, 0.4);
    }

    .breadcrumb {
        display: flex;
        align-items: center;
        gap: 8px;
        margin-bottom: 30px;
        font-size: 14px;
        color: var(--muted);
    }

    .breadcrumb a {
        color: var(--accent);
        text-decoration: none;
    }

    .breadcrumb a:hover {
        text-decoration: underline;
    }

    /* ==================== RESPONSIVE ==================== */
    @media (max-width: 768px) {
        .training-header {
            padding: 60px 24px;
            margin-bottom: 40px;
        }

        .training-header h1 {
            font-size: 32px;
        }

        .topic-grid {
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 20px;
        }

        .topic-card {
            padding: 24px;
        }

        .phase-tabs {
            margin: 0 -8px 30px;
            padding: 0 8px;
        }

        .phase-header {
            flex-wrap: wrap;
        }
    }
</style>

<script src="https://cdnjs.cloudflare.com/ajax/libs/feather-icons/4.29.0/feather.min.js"></script>
<script>
    function showPhase(phaseIndex) {
        // Hide all phase contents
        document.querySelectorAll('.phase-content').forEach(el => {
            el.classList.remove('active');
        });

        // Remove active from all tabs
        document.querySelectorAll('.tab-btn').forEach(el => {
            el.classList.remove('active');
        });

        // Show selected phase
        document.getElementById('phase-' + phaseIndex).classList.add('active');
        document.getElementById('tab-' + phaseIndex).classList.add('active');

        // Re-initialize feather icons
        feather.replace();
    }

    // Show first phase on load
    window.addEventListener('DOMContentLoaded', function () {
        showPhase(1);
        // Initialize feather icons on page load
        feather.replace();
    });
</script>

<!-- Breadcrumb -->
<div class="breadcrumb">
    <a href="{{ url_for('index') }}">Home</a>
    <span>â€º</span>
    <span>{{ training.name }}</span>
</div>

<!-- Training Header -->
<div class="training-header">
    <div style="position: relative; z-index: 2; animation: slide-in-up 0.6s ease-out;">
        <h1 style="font-size: clamp(32px, 5vw, 48px); margin: 0 0 16px 0; background: linear-gradient(135deg, #38bdf8, #a855f7, #f97316); -webkit-background-clip: text; background-clip: text; color: transparent; font-weight: 800;">{{ training.name }}</h1>
        {% if training.description %}
        <p style="color: #cbd5e1; margin: 0 0 24px 0; font-size: 16px; line-height: 1.7; max-width: 800px;">
            {{ training.description }}
        </p>
        {% endif %}
        <div style="display: flex; gap: 16px; flex-wrap: wrap;">
            <div style="padding: 10px 18px; background: rgba(56, 189, 248, 0.1); border: 1.5px solid rgba(56, 189, 248, 0.2); border-radius: 10px; font-size: 14px; display: flex; align-items: center; gap: 8px;">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#38bdf8" stroke-width="1.5">
                    <path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"></path>
                    <path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"></path>
                </svg>
                <div>
                    <strong style="color: #38bdf8; display: block;">{{ phases|length }}</strong>
                    <span style="color: #9ca3af; font-size: 12px; text-transform: uppercase; letter-spacing: 0.5px;">Phases</span>
                </div>
            </div>
            <div style="padding: 10px 18px; background: rgba(56, 189, 248, 0.1); border: 1.5px solid rgba(56, 189, 248, 0.2); border-radius: 10px; font-size: 14px; display: flex; align-items: center; gap: 8px;">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#38bdf8" stroke-width="1.5">
                    <circle cx="12" cy="12" r="10"></circle>
                    <circle cx="12" cy="12" r="6"></circle>
                    <circle cx="12" cy="12" r="2"></circle>
                </svg>
                <div>
                    <strong style="color: #38bdf8; display: block;">{{ phases.values()|map('length')|sum }}</strong>
                    <span style="color: #9ca3af; font-size: 12px; text-transform: uppercase; letter-spacing: 0.5px;">Topics</span>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Instructors Section -->
{% if training.instructors %}
<div style="margin-bottom: 60px;">
    <h3 style="font-size: 28px; font-weight: 700; margin-bottom: 30px; background: linear-gradient(135deg, #38bdf8, #a855f7); -webkit-background-clip: text; background-clip: text; color: transparent;">Meet the Instructors</h3>
    <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 28px;">
        {% for instructor in training.instructors %}
        <a href="{{ url_for('instructor_profile', instructor_id=instructor.id) }}" style="
            position: relative;
            background: linear-gradient(135deg, rgba(15, 23, 42, 0.7) 0%, rgba(15, 23, 42, 0.5) 100%);
            border: 1.5px solid rgba(56, 189, 248, 0.15);
            border-radius: 18px;
            padding: 28px;
            text-decoration: none;
            color: inherit;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            overflow: hidden;
            backdrop-filter: blur(10px);
            display: flex;
            flex-direction: column;
            gap: 12px;
        " onmouseover="this.style.borderColor='rgba(56, 189, 248, 0.4)'; this.style.backgroundColor='rgba(15, 23, 42, 0.85)'; this.style.transform='translateY(-8px)'; this.style.boxShadow='0 20px 50px rgba(56, 189, 248, 0.25)'"
            onmouseout="this.style.borderColor='rgba(56, 189, 248, 0.15)'; this.style.backgroundColor=''; this.style.transform='translateY(0)'; this.style.boxShadow=''">
            <div style="font-size: 18px; font-weight: 700; margin-bottom: 6px; color: #f9fafb;">{{ instructor.name }}</div>
            <div style="font-size: 13px; color: #38bdf8; margin-bottom: 8px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px;">{{ instructor.role or 'QA Instructor' }}</div>
            {% if instructor.expertise %}
            <div style="display: flex; flex-wrap: wrap; gap: 8px; padding-top: 8px; border-top: 1px solid rgba(56, 189, 248, 0.1);">
                {% for tag in instructor.expertise.split(',')[:3] %}
                <span style="padding: 6px 12px; background: rgba(56, 189, 248, 0.1); border: 1px solid rgba(56, 189, 248, 0.2); border-radius: 8px; font-size: 12px; color: #38bdf8; font-weight: 600;">{{ tag.strip() }}</span>
                {% endfor %}
            </div>
            {% endif %}
        </a>
        {% endfor %}
    </div>
</div>
{% endif %}

<!-- Tabbed Phase Navigation -->
<nav class="phase-tabs">
    <div class="tabs-container">
        {% for phase in phases.keys() %}
        <button id="tab-{{ loop.index }}" class="tab-btn" onclick="showPhase({{ loop.index }})">
            <span class="tab-number">{{ loop.index }}</span>
            <span>{{ phase|regex_replace('^\d+\s*-\s*', '') }}</span>
            <span class="tab-count">({{ phases[phase]|length }})</span>
        </button>
        {% endfor %}
    </div>
</nav>

<!-- Phase Contents -->
{% for phase, topics in phases.items() %}
<div id="phase-{{ loop.index }}" class="phase-content">
    <div class="phase-header">
        <div class="phase-number">{{ loop.index }}</div>
        <h2 class="phase-title">{{ phase|regex_replace('^\d+\s*-\s*', '') }}</h2>
        <span style="margin-left: auto; color: var(--muted); font-size: 14px;">{{ topics|length }} topics</span>
    </div>

    <div class="topic-grid">
        {% for topic in topics %}
        <a href="{{ url_for('topic_detail', topic_id=topic.id) }}" class="topic-card">
            <h3 class="topic-title">{{ topic.name }}</h3>
            <div class="topic-meta">
                {% if topic.instructor %}
                <span class="topic-badge">
                    <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                        <circle cx="12" cy="7" r="4"></circle>
                    </svg>
                    {{ topic.instructor }}
                </span>
                {% endif %}
                {% if topic.video_url %}
                <span class="topic-badge video">
                    <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polygon points="5 3 19 12 5 21 5 3"></polygon>
                    </svg>
                    Video
                </span>
                {% endif %}
            </div>
        </a>
        {% endfor %}
    </div>
</div>
{% endfor %}

{% endblock %}