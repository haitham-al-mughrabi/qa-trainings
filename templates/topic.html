{% extends 'base.html' %}

{% block content %}
<div style="margin-bottom: 30px;">
    <a href="{{ url_for('training_detail', training_id=topic.training_id) }}" style="color: var(--accent); text-decoration: none; font-size: 14px;">‚Üê Back to Training</a>
</div>

<div style="background: var(--bg-alt); border: 1px solid var(--border); border-radius: var(--radius); overflow: hidden; margin-bottom: 30px;">
    <div style="padding: 30px;">
        {% if topic.phase %}
        <div style="font-size: 12px; text-transform: uppercase; letter-spacing: 1px; color: var(--accent); margin-bottom: 10px;">{{ topic.phase }}</div>
        {% endif %}
        <h1 style="font-size: 28px; margin: 0 0 10px 0;">{{ topic.name }}</h1>
        {% if topic.instructor %}
        <div style="color: var(--muted); font-size: 14px;">Instructor: {{ topic.instructor }}</div>
        {% endif %}
        
        {% if topic.description %}
        <p style="color: var(--text-light); margin-top: 20px; line-height: 1.6;">{{ topic.description }}</p>
        {% endif %}
    </div>

    {% if topic.video_url %}
    <div style="position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden; border-top: 1px solid var(--border);">
        <iframe style="position: absolute; top: 0; left: 0; width: 100%; height: 100%;" 
                src="{{ topic.video_url.replace('youtu.be/', 'www.youtube.com/embed/').replace('watch?v=', 'embed/') }}" 
                frameborder="0" 
                allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" 
                allowfullscreen>
        </iframe>
    </div>
    {% endif %}
</div>

<div style="display: grid; grid-template-columns: 1fr 1fr; gap: 30px;">
    <!-- Attendance Card -->
    <div style="background: var(--bg-alt); border: 1px solid var(--border); border-radius: var(--radius); padding: 20px;">
        <h2 style="font-size: 18px; margin-bottom: 20px; border-bottom: 1px solid var(--border); padding-bottom: 10px;">Attendance</h2>
        <form method="POST" action="{{ url_for('topic_detail', topic_id=topic.id) }}">
            <input type="hidden" name="action" value="attendance">
            <div style="margin-bottom: 15px;">
                <label style="display: block; margin-bottom: 5px; font-size: 13px; color: var(--muted);">Date</label>
                <input type="date" name="date" required style="background: #1e293b; border: 1px solid #334155; color: white; padding: 8px; border-radius: 4px; width: 100%;">
            </div>
            
            <div style="max-height: 300px; overflow-y: auto; margin-bottom: 20px;">
                {% for student in students %}
                <div style="padding: 10px 0; border-bottom: 1px solid rgba(148, 163, 184, 0.1);">
                    <div style="font-weight: 500; margin-bottom: 5px;">{{ student.name }}</div>
                    <div style="display: flex; gap: 15px; font-size: 13px;">
                        <label><input type="radio" name="student_{{ student.id }}" value="Present" required> Present</label>
                        <label><input type="radio" name="student_{{ student.id }}" value="Absent"> Absent</label>
                        <label><input type="radio" name="student_{{ student.id }}" value="Excused"> Excused</label>
                    </div>
                </div>
                {% endfor %}
            </div>
            <button type="submit" class="btn-primary" style="width: 100%;">Save Attendance</button>
        </form>
    </div>

    <!-- Progress Card -->
    <div style="background: var(--bg-alt); border: 1px solid var(--border); border-radius: var(--radius); padding: 20px;">
        <h2 style="font-size: 18px; margin-bottom: 20px; border-bottom: 1px solid var(--border); padding-bottom: 10px;">Progress</h2>
        <form method="POST" action="{{ url_for('topic_detail', topic_id=topic.id) }}">
            <input type="hidden" name="action" value="progress">
            <div style="max-height: 365px; overflow-y: auto; margin-bottom: 20px;">
                {% for student in students %}
                <div style="padding: 10px 0; border-bottom: 1px solid rgba(148, 163, 184, 0.1); display: flex; justify-content: space-between; align-items: center;">
                    <div style="font-weight: 500;">{{ student.name }}</div>
                    <select name="student_{{ student.id }}" style="background: #1e293b; border: 1px solid #334155; color: white; padding: 5px; border-radius: 4px; font-size: 13px;">
                        <option value="Not Started" {% if progress_map.get(student.id) == 'Not Started' %}selected{% endif %}>Not Started</option>
                        <option value="In Progress" {% if progress_map.get(student.id) == 'In Progress' %}selected{% endif %}>In Progress</option>
                        <option value="Completed" {% if progress_map.get(student.id) == 'Completed' %}selected{% endif %}>Completed</option>
                    </select>
                </div>
                {% endfor %}
            </div>
            <button type="submit" class="btn-primary" style="width: 100%;">Update Progress</button>
        </form>
    </div>
</div>
{% endblock %}
